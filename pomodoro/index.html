<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="description" content="pomodoro clock hourglass timer">
		<meta name="keywords" content="pomodoro clock hourglass timer">
		<meta name="author" content="Nikola Tasic">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="shortcut icon" type="image" href="./favico.png"> <!-- Webpage icon -->
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.css"> <!-- reset.css -->
		<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css"> <!-- Bootstrap -->
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.css"> <!-- Animate.css -->
		<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> <!-- FontAwesome -->
		<link href="https://fonts.googleapis.com/css?family=Joti+One" rel="stylesheet"> 	
		<style type="text/css">
			input, button,h2{
				font-family: 'Joti One', cursive;
				font-size: 32px;
			}
			input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button {
			    -webkit-appearance: none;
			    margin: 0;
			}
			 
			input[type="number"] {
			    -moz-appearance: textfield;
			}
			input {
				margin-right: 5px;
				margin-top: 5px;
				text-align: center;
				border-radius: 5px;
				border: 5px solid #333;
				height: 50px;
				width: 140px
			}
			button {
				margin-left: 5px;
				margin-top: 5px;
				background-color: white;
				border-radius: 5px;
				border: 5px solid #333;
				color: #333;
				height: 50px;
				width: 140px
			}
			button:hover {
				color: white;
				background-color: #333;
				border-color: #333;
			}
			#timeDisplay {
				font-size: 40px;
				position: relative;
				top: 200px;
			}
			.col-6 {
				text-align: left;
			}
			.col-6:first-of-type {
				text-align: right;
			}
			.container {
				min-width: 600px;
			}
			@media all and (max-width: 766px){
				#hourglassContainer {
					width: 400px;
					height: 400px;
				}
				#timeDisplay {
				font-size: 30px;
				position: relative;
				top: 100px;
				}
			}
		</style>
		<title>Hourglass</title>
	</head>
	<body>
		<div class="container" style="text-align: center;">
			<h2 id="timeDisplay">00:00</h2>
			<script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script> <!-- jQuery -->
			<?xml version="1.0" encoding="utf-8"?>
			<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
				 viewBox="0 0 400 400" style="enable-background:new 0 0 400 400;" xml:space="preserve" width="600" height="600" id="hourglassContainer">
			<style type="text/css">
				.st0{fill:#999999;stroke:#999999;stroke-width:8;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
				.st1{fill:#FFFFFF;stroke:#000000;stroke-width:8;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
				.st2{fill:#FFFFFF;stroke:#333333;stroke-width:8;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
				.st3{fill:#B3B3B3;}
				.cliptop {
					clip-path: url('#masktop')
				}
				.clipbot {
					clip-path: url('#maskbottom')
				}
				.sand {
					animation-name: sandfall;
					animation-duration: 2s;
					animation-iteration-count: infinite;
					animation-timing-function: ease-in;
				}
				@keyframes sandfall {
					0% { display: none;
						transform: translateY(0px);
					}
					100%{
						transform: translateY(190px);
					}
				}
			</style>
			<g id="Sand">
				<circle class="st3 sand" style="display: none;" cx="194.8" cy="158" r="2.8"/>
				<circle class="st3 sand" style="display: none;" cx="200.3" cy="159.6" r="1.8"/>
				<circle class="st3 sand" style="display: none;" cx="215.3" cy="157" r="2.3"/>
				<circle class="st3 sand" style="display: none;" cx="211.3" cy="159.3" r="1.7"/>
				<circle class="st3 sand" style="display: none;" cx="189.2" cy="158.1" r="2.1"/>
				<circle class="st3 sand" style="display: none;" cx="206.3" cy="158.6" r="2.8"/>
				<circle class="st3 sand" style="display: none;" cx="200" cy="156" r="1.8"/>
				<circle class="st3 sand" style="display: none;" cx="203.5" cy="154.5" r="2"/>
			</g>
			<g id="Top_Sand">
				<g>
					<path class="st0 cliptop" d="M280.2,54.7c0.5,6.3,3.2,45.7-12.6,63c-1.2,1.3-6.2,6.6-13.5,12.6c-5.7,4.7-10.2,7.7-18.9,13.5
						c-10.8,7.2-16.2,10.8-18.9,11.7c-14.1,4.9-26.9,0.7-28.8,0c-2.7-0.9-8.1-4.6-18.9-11.7c-7.5-5-12.7-8.4-18.9-13.5
						c-7.2-5.9-12.2-11.2-13.5-12.6c-15.5-17.1-14.5-56.5-13.5-63H280.2z"/>
				</g>
				<path class="st1" d="M510,104"/>
			</g>
			<g id="Bottom_Sand">
				<g>
					<path class="st0 clipbot" d="M280.2,351.3c0.5-6.3,3.2-45.7-12.6-63c-1.2-1.3-6.2-6.6-13.5-12.6c-5.7-4.7-10.2-7.7-18.9-13.5
						c-10.8-7.2-16.2-10.8-18.9-11.7c-14.1-4.9-26.9-0.7-28.8,0c-2.7,0.9-8.1,4.6-18.9,11.7c-7.5,5-12.7,8.4-18.9,13.5
						c-7.2,5.9-12.2,11.2-13.5,12.6c-15.5,17.1-14.5,56.5-13.5,63H280.2z"/>
				</g>
			</g>
			<g id="Hourglass">
				<path class="st1" d="M99.7,370"/>
				<path class="st1" d="M299.7,30"/>
				<path class="st1" d="M299.7,370"/>
				<g>
					<polyline class="st2" points="325,30 200,30 75,30 		"/>
					<polyline class="st2" points="325,370 198.3,370 75,370 		"/>
					<path class="st2" d="M99.7,30C96,104.3,111.5,130.9,127,141c12.1,7.9,23.8,16.3,36,24c13.8,8.7,23.3,14,27,25
						c1.2,3.5,1.6,6.9,1.5,10c0,3.1-0.4,6.5-1.5,10c-3.7,11-13.2,16.3-27,25c-12.2,7.7-23.9,16.1-36,24c-15.5,10.1-31,36.7-27.3,111"/>
					<path class="st2" d="M305,30c3.7,74.3-11.8,100.9-27.3,111c-12.1,7.9-23.8,16.3-36,24c-13.8,8.7-23.3,14-27,25
						c-1.2,3.5-1.6,6.9-1.5,10c0,3.1,0.4,6.5,1.5,10c3.7,11,13.2,16.3,27,25c12.2,7.7,23.9,16.1,36,24c15.5,10.1,31,36.7,27.3,111"/>
					<line class="st2" x1="75" y1="15" x2="325" y2="15"/>
					<line class="st2" x1="75" y1="384" x2="325" y2="384"/>
				</g>
			</g>

		    <clipPath id="maskbottom">
		    	<rect x="0" y="356" width="400" height="112" class="clipstyle" id="botmask">
				<!--<animate attributeType="auto"
			        	attributeName="y"
			        	from="356" to="244"
			            dur="500ms"
			            repeatCount="indefinite"/> -->
		    	</rect>
		    </clipPath>
		    <clipPath id="masktop">
		    	<rect x="0" y="50" width="400" height="112" class="clipstyle" id="topmask">
				<!--<animate attributeType="auto"
			        	attributeName="y"
			        	from="50" to="162"
			            dur="500ms"
			            repeatCount="indefinite"/> -->
		    	</rect>
	   		</clipPath>
			</svg>
			<div class="row">
			<div class="col-6">
				<input type="number" name="time" id="time" placeholder="Minutes" class="animated shake">
				
				<input type="number" name="time" id="break" placeholder="Break" class="animated shake">
			</div>
			<div class="col-6">
				<button id="set-time" onclick="startTime()">Start</button>
				
				<button id="reset-time" onclick="resetTime()">Reset</button>
			</div>
			</div>
		</div>
		<script type="text/javascript">
			document.getElementById('time').value = 25;
			document.getElementById('break').value = 1;
			var timeKeeper = '';
			const botMask = document.getElementById('botmask');
			const topMask = document.getElementById('topmask');
			const botMaskStart = botMask.getAttribute('y');
			const botMaskEnd = botMask.getAttribute('y') - botMask.getAttribute('height');
			const topMaskStart = topMask.getAttribute('y');
			const topMaskEnd = topMask.getAttribute('y') + topMask.getAttribute('height');
			var interval = 0;
			var timeInput = 0;
			var breakInput = 0;
			var timeRemaining = 0;
			var minutes = 0;
			var seconds = 0;
			function breakStart(){
				setTimeout(function(){
					if (document.getElementById('break').value != ""){
						breakInput = Math.ceil(parseInt(document.getElementById('break').value));

						if (!isNaN((parseInt(document.getElementById('break').value)))){

							if (typeof parseInt(document.getElementById('break').value) == 'number'){
								document.getElementsByClassName('st0')[0].style.fill = '#8c0000'
								document.getElementsByClassName('st0')[1].style.fill = '#8c0000'
								document.getElementsByClassName('st0')[0].style.stroke = "#8c0000"
								document.getElementsByClassName('st0')[1].style.stroke = '#8c0000'

								interval = (topMask.getAttribute('height') / breakInput) / 60;
								timeRemaining = breakInput * 60;
								timeKeeper = setInterval(breakTime, 1000);
								randomizeSand();

							} else {

								alert('Please input a whole number.')
								

							}

						} else {

							alert('Please input a whole number.')
							
						}
					}	
					},1000)
					
			}
			function rotateHourglass() {
				document.getElementById('timeDisplay').classList.add('animated');
				document.getElementById('timeDisplay').classList.add('flip');
				document.getElementById('hourglassContainer').classList.add('animated');
				document.getElementById('hourglassContainer').classList.add('flip');
				setTimeout(function(){
					document.getElementById('timeDisplay').classList.remove('animated');
					document.getElementById('timeDisplay').classList.remove('flip');
					document.getElementById('hourglassContainer').classList.remove('animated');
					document.getElementById('hourglassContainer').classList.remove('flip');
				},1000)
			}
			function resetTime(){
				document.getElementsByClassName('st0')[0].style.fill = '#999999'
				document.getElementsByClassName('st0')[1].style.fill = '#999999'
				document.getElementsByClassName('st0')[0].style.stroke = '#999999'
				document.getElementsByClassName('st0')[1].style.stroke = '#999999'
				document.getElementById('timeDisplay').innerHTML = minutes + ':' + seconds;
				timeRemaining--;
				interval = 0;
				breakInput = 0;
				timeInput = 0;
				timeRemaining = 0;
				document.getElementById('timeDisplay').innerHTML = '00:00'
				clearInterval(timeKeeper);
				rotateHourglass();
				hideSand();
				setTimeout(function(){
					botMask.setAttribute('y', botMaskStart);
					topMask.setAttribute('y', topMaskStart);
				},1000);
			}
			function randomizeSand(){
				var sandParticles = document.getElementsByClassName('sand');
				for (let i = 0; i < sandParticles.length; i++){
					sandParticles[i].style.animationDelay = parseFloat(Math.random() * 5 + 1).toFixed(3) + 's';
					sandParticles[i].style.display = 'initial';
				}
			}
			function sandTime(){
				var topMaskCurrent = parseFloat(topMask.getAttribute('y'));
				var botMaskCurrent = parseFloat(botMask.getAttribute('y'));

				minutes = Math.floor(timeRemaining/60);
				seconds = timeRemaining % 60;

				if ((Math.round(topMaskCurrent) < topMaskEnd) && (Math.round(botMaskCurrent) > botMaskEnd)) {
					topMask.setAttribute('y', topMaskCurrent + interval);
					botMask.setAttribute('y', botMaskCurrent - interval);
					if (seconds < 10){
						document.getElementById('timeDisplay').innerHTML = minutes + ':0' + seconds;
						timeRemaining--;
					} else {
						document.getElementById('timeDisplay').innerHTML = minutes + ':' + seconds;
						timeRemaining--;
					}
					
				} else if (document.getElementsByClassName('st0')[0].style.fill == '#8c0000')  {
					var wav = 'http://www.freesfx.co.uk/rx2/mp3s/4/16413_1460641330.mp3';
				    var audio = new Audio(wav);
						audio.play();
					resetTime();
				} else {
					var wav = 'http://www.freesfx.co.uk/rx2/mp3s/4/16413_1460641330.mp3';
				    var audio = new Audio(wav);
						audio.play();
					resetTime();
					breakStart();
					
				}
			};
			function breakTime(){
				var topMaskCurrent = parseFloat(topMask.getAttribute('y'));
				var botMaskCurrent = parseFloat(botMask.getAttribute('y'));

				minutes = Math.floor(timeRemaining/60);
				seconds = timeRemaining % 60;

				if ((Math.round(topMaskCurrent) < topMaskEnd) && (Math.round(botMaskCurrent) > botMaskEnd)) {
					topMask.setAttribute('y', topMaskCurrent + interval);
					botMask.setAttribute('y', botMaskCurrent - interval);
					if (seconds < 10){
						document.getElementById('timeDisplay').innerHTML = minutes + ':0' + seconds;
						timeRemaining--;
					} else {
						document.getElementById('timeDisplay').innerHTML = minutes + ':' + seconds;
						timeRemaining--;
					}
					
				} else {
					var wav = 'http://www.freesfx.co.uk/rx2/mp3s/4/16413_1460641330.mp3';
				    var audio = new Audio(wav);
						audio.play();
					resetTime();
				}
			};
			function hideSand(){
				var sandParticles = document.getElementsByClassName('sand');
				for (let i = 0; i < sandParticles.length; i++){
					sandParticles[i].style.display = 'none';
				}
			}
			function showSand(){
				var sandParticles = document.getElementsByClassName('sand');
				for (let i = 0; i < sandParticles.length; i++){
					sandParticles[i].style.display = 'initial';
				}
			}
			function startTime(){
				timeInput = Math.ceil(parseInt(document.getElementById('time').value));
				if (!isNaN((parseInt(document.getElementById('time').value)))){

					if (typeof parseInt(document.getElementById('time').value) == 'number'){

						interval = (topMask.getAttribute('height') / timeInput) / 60;
						timeRemaining = timeInput * 60;
						timeKeeper = setInterval(sandTime, 1000);
						randomizeSand();

					} else {
						alert('Please input a whole number.')
					}
				} else {

					alert('Please input a whole number.')
				}
			}
			
			
		</script>
	</body>
</html>
